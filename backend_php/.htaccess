RewriteEngine On
RewriteBase /

# Handle CORS
<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
  Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
</IfModule>

# Handle Options method
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ - [R=204,L]

# API Routes (assuming this .htaccess is in backend_php/)

# Auth routes
RewriteRule ^api/auth/login$ api/auth/login.php [L,QSA]

# Projects routes
RewriteCond %{REQUEST_METHOD} GET
RewriteRule ^api/projects$ api/projects/read.php [L,QSA]

RewriteCond %{REQUEST_METHOD} GET
RewriteRule ^api/projects/([0-9]+)$ api/projects/read_one.php?id=$1 [L,QSA]

RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/projects$ api/projects/create.php [L,QSA]

# Multi-part POST for updates
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/projects/([0-9]+)$ api/projects/update.php?id=$1 [L,QSA]

RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/projects/([0-9]+)$ api/projects/update.php?id=$1 [L,QSA]

RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/projects/([0-9]+)$ api/projects/delete.php?id=$1 [L,QSA]

# Careers routes
RewriteCond %{REQUEST_METHOD} GET
RewriteRule ^api/careers$ api/careers/read.php [L,QSA]

RewriteCond %{REQUEST_METHOD} GET
RewriteRule ^api/careers/([0-9]+)$ api/careers/read_one.php?id=$1 [L,QSA]

RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/careers$ api/careers/create.php [L,QSA]

RewriteCond %{REQUEST_METHOD} PUT
RewriteRule ^api/careers/([0-9]+)$ api/careers/update.php?id=$1 [L,QSA]

RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/careers/([0-9]+)$ api/careers/delete.php?id=$1 [L,QSA]

# Applications
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^api/applications$ api/applications/create.php [L,QSA]

RewriteCond %{REQUEST_METHOD} GET
RewriteRule ^api/applications$ api/applications/read.php [L,QSA]

RewriteCond %{REQUEST_METHOD} DELETE
RewriteRule ^api/applications/([0-9]+)$ api/applications/delete.php?id=$1 [L,QSA]

# Uploads access
RewriteRule ^api/uploads/(.*)$ uploads/$1 [L]
